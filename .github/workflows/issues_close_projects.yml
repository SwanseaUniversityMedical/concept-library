name: 'Issue States/open/close'

on:
  project_card:
    types: [created, edited, moved]

jobs:
  closeIssue:
    runs-on: ubuntu-latest
    steps:
      - name: Check if card status is 'Moved'
        id: checkCardStatus
        run: echo "::set-output name=status::${{ github.event.project_card.previous_column_name }}"

      - name: Close Issue
        if: ${{ steps.checkCardStatus.outputs.status == 'Deploy to Demo' || steps.checkCardStatus.outputs.status == 'Waiting Deployment to Live' || steps.checkCardStatus.outputs.status == 'In Production' }}
        run: gh issue close ${{ github.event.project_card.content_url }} --comment 'Issue closed due to card being moved'
