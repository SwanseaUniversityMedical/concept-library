<!DOCTYPE html>
<html lang="en">
	{% load static %}
	{% load mathfilters %}

	<head>
		<meta charset="utf-8">
    	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    	<meta name="description" content="{% block description %}{% endblock description %}">
    	<link rel="shortcut icon" href="{% static 'img/favicon.ico' %}">

    	<title>Concept Library {% block title %}{% endblock title %}</title>

		<!-- core styles -->
		<link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet" />
		<link href="{% static 'css/autocomplete.css' %}" rel="stylesheet" />
		<link href="{% static 'lib/font-awesome-4.7.0/css/font-awesome.min.css' %}" rel="stylesheet" />
		<link href="{% static 'css/clusterize.css' %}" rel="stylesheet" type="text/css">
		<link href="{% static 'css/jstree/style.min.css' %}" rel="stylesheet" />
		<link href="{% static 'lib/bootstrap-datepicker/css/bootstrap-datepicker.min.css' %}" rel="stylesheet" />
		<link href="{% static 'css/bootstrap-tagsinput.css' %}" rel="stylesheet" />
		<link href="{% static 'css/bootstrap-tagsinput-typeahead.css' %}" rel="stylesheet" />
		<link href="{% static 'css/query-builder.default.min.css' %}" rel="stylesheet" />
		<link href="{% static 'css/site.css' %}" rel="stylesheet" />

		{% block styles %}
		<link href="{% static 'css/main.css' %}" rel="stylesheet" />
		{% if request.CURRENT_BRAND|length %}
		<link href="{% static 'css/brands/' %}{{request.CURRENT_BRAND}}/brand.css" rel="stylesheet" />
		{% endif %}
		{% endblock styles %}

		{% block head %}{% endblock head %}

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="{% static 'js/lib/html5shiv.min.js' %}" type="text/javascript"></script>
      <script src="{% static 'js/lib/respond.min.js' %}" type="text/javascript"></script>
    <![endif]-->
	</head>

	<body>
		<div class="loader" style="display:none;"></div>
		<nav class="navbar navbar-inverse navbar-fixed-top">
		<span style="color:yellow;position:absolute;left: 0;top: 0;">{{ DEV_PRODUCTION|safe }}</span>
			<div class="container">
				<div id="navbar" class="navbar-collapse collapse">
					<div class="navbar-header">

						{% if request.CURRENT_BRAND|length %}
							<a id="logo-link"  class="navbar-brand"
							    {% if request.CURRENT_BRAND_WEBSITE|length %}
							 	  href="{{ request.CURRENT_BRAND_WEBSITE }}"
							    {% endif %}
                              target=_blank >
								<img style="margin-top: -10px;" src="{% static 'img/brands/' %}{{request.CURRENT_BRAND}}/header_logo.png" height="45px"  alt="{{request.CURRENT_BRAND}} Logo" />
							</a>
						{% endif %}

						<a id="logo-link-cl"  href="/{% if request.CURRENT_BRAND|length %}
								{{ request.CURRENT_BRAND }}/home/
								{% else %}home/
								{% endif %}"  class="navbar-brand" >
							<img style="margin-top: -10px;"
							src="{% static 'img/' %}{% if request.CURRENT_BRAND|length %}
								brands/{{request.CURRENT_BRAND}}/cl_logo_dark_1600px_{{ request.CURRENT_BRAND }}.png
								{% else %}
								cl_logo_dark_1600px.png
								{% endif %}"
							height="45px"  alt="Concept Library Logo" />
						</a>

					</div>


					<ul class="list-inline nav navbar-nav" id='prjnavtabs' >
						<li id="concept_li" >
							<a id="concept_a"  class="main_menu" href="{% url 'concept_list' %}">Concepts</a>
						</li>

						{% if user.is_authenticated %}
							<li id="workingset_li"  >
								<a id="workingset_a" class="main_menu" href="{% url 'workingset_list' %}">Working Sets</a>
							</li>
						{% endif %}

						<li id="phenotype_li">
							<a id="phenotype_a" class="main_menu" href="{% url 'phenotype_list' %}">Phenotypes</a>
						</li>

						{% if user.is_authenticated %}
							<li id="api_li"  >
								<a id="api_a" class="main_menu"
								 {% if request.CURRENT_BRAND|length %}
								 	href="/{{ request.CURRENT_BRAND }}/api/"
								 {% else %}
								 	href="/api/"
								 {% endif %}
								 target=_blank >API</a>
							</li>
						{% endif %}

						{% if request.user.is_superuser and SHOWADMIN and not CLL_READ_ONLY %}
						   <li id="admin_li"  >
						  		<a id="admin_a" class="main_menu" href="{% url 'admin:index' %}" target=_blank >Admin</a>
						   </li>
						{% endif %}
					</ul>



					<div class="navbar-header" style="float: right !important;">

					   	 {% if request.user.is_superuser and user.is_authenticated and request.session.all_brands %}
						   <div class="nav navbar-nav">
						    <span {% if not request.CURRENT_BRAND|length %}
						            style="color: white;"
						          {% endif %}
						    >&nbsp;&nbsp;&nbsp;Brand</span>
							  <p class="active" style="position:relative;display: block;padding: 2px 5px">
							     <select  name="userBrand" id="userBrand"  >
								    <option value=""  style='background-color: lightgreen;' >Default</option>
								{% for brand in request.session.all_brands %}
									<option value="{{ brand|upper }}"
									       {% if brand|upper == request.session.current_brand|upper %} selected="selected" {% endif %}
									       >
											{{ brand|upper }}
											{% if brand|upper in request.session.user_brands %} (*) {% endif %}
									</option>
								{% empty %}
									<option value="-1" >No Brands !!!</option>
								{% endfor %}
								  </select>
							  </p>
							</div>
						{% endif %}

						<p class="navbar-text">
							{% if CLL_READ_ONLY %}
							   <span style="color:yellow;">read only&nbsp;&nbsp;</span>
							{% endif %}

							{% if user.is_authenticated %}
								<i class="fa fa-user" aria-hidden="true"></i>
								<span style00="color: white;" title="{{ user.get_username }}" >{{ user.get_username }} </span>

								<span style="width: 20px;">&nbsp;</span>

								{% if not CLL_READ_ONLY and 1 == 2 %}
									<i class="glyphicon glyphicon-lock" aria-hidden="true"></i>
									<a  href="{% url 'password_change' %}">Change Password</a>
								  <span style="width: 20px;">&nbsp;</span>
								{% endif %}

								<a class="navbar-link" href="{% url 'logout' %}?next={% url 'concept_list' %}">
									<i class="fa fa-sign-out" aria-hidden="true"></i> Log out
								</a>
							{% else %}
								<a class="navbar-link" href="{% url 'login' %}?next={{ request.path|urlencode }}">
									<i class="fa fa-sign-in" aria-hidden="true"></i> Log in
								</a>
							{% endif %}
						</p>
					</div>

				</div>
			</div>
		</nav>
		<div class="container">
			{% block messages %}
				{% if messages %}
					{% for message in messages %}
						<div class="alert alert-{{ message.tags }}">
							<a class="close" data-dismiss="alert">x</a>
							{{ message|safe }}
						</div>
					{% endfor %}
				{% endif %}
			{% endblock messages %}

			{% block container %}{% endblock container %}

			<div class="modal fade" id="modal-section">
				<div class="modal-dialog">
					<div class="modal-content">

					</div>
				</div>
			</div>
		</div>
		<br/>
		<!-- SITE FOOTER -->
		{% block footer %}
		<footer>
			<div class="container" id="baseFooter" >
			    <span style="color:yellow;">{{ DEV_PRODUCTION|safe }}</span>
				<p>Copyright &copy; {% now 'Y' %} - SAIL Databank - Swansea University. All rights reserved.</p>

				<div class="navbar-header">
					<a href="http://saildatabank.com" target=_blank  class="navbar-brand" rel="noopener noreferrer">
						<img style="margin-top: -10px;" src="{% static 'img/SAIL2-d.png' %}" height="45px"  alt="SAIL Databank Logo" />
					</a>
					<a href="http://www.swansea.ac.uk" target=_blank  class="navbar-brand" rel="noopener noreferrer">
						<img style="margin-top: -10px;" src="{% static 'img/logo.png' %}" height="45px" alt="Swansea University Logo" />
					</a>
				</div>
			</div>
		</footer>
		{% endblock footer %}

		<script src="{% static 'js/lib/jquery/jquery-3.1.1.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/moment-with-locales.min.js'%}" type="text/javascript"></script>
		<script src="{% static 'js/lib/bootstrap/bootstrap.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/jquery.autocomplete.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/clusterize.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/jstree/jstree.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'lib/bootstrap-datepicker/js/bootstrap-datepicker.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/bootstrap-tagsinput.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/typeahead.bundle.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/jQuery.extendext.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/doT.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/query-builder.min.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/jquery.validate.js' %}" type="text/javascript"></script>
		<script src="{% static 'js/lib/additional-methods.min.js' %}" type="text/javascript"></script>



		<script>
			$(function(){
				if ($(".input-group.date")[0]){
					$('.input-group.date').datepicker({
						autoclose: true,
						format: 'dd/mm/yyyy',
						pickDate: true,
						todayHighlight: true,
					});
				}
			});



		</script>

		<script type="text/javascript">
		//Setting an active menu item based on the current URL with jQuery

			$(function () {
			    setNavigation();
			});

			function setNavigation() {
			    var path = window.location.pathname;
			    path = path.replace(/\/$/, "");
			    path = decodeURIComponent(path);

			    $("#prjnavtabs a").each(function () {
			        var href = $(this).attr('href');
			        href = href.replace(/\/$/, "");
			        if (path.substring(0, href.length) === href) {
			            $(this).closest('li').addClass('active');
			        }
			    });
			}

		</script>

		<script>
			$(function(){
				var lTrimRegex = new RegExp('^/');
				var lTrim = function(input){
				    return input.replace(lTrimRegex, '');
				}

				var all_brands = []; // {{ request.session.all_brands|safe }};
				{% for brand in request.session.all_brands %}
					all_brands.push('{{ brand|upper }}');
			    {% endfor %}

				$( '#userBrand' ).on('change', function(e){
					$(".loader").show();
					var path = window.location.pathname;
					path = lTrim(path);
					old_root = path.split('/')[0];

					new_root = '';
					if(this.value != ''){
						new_root = '/' + this.value;
					}

					indx = 1;
					if(all_brands.indexOf(old_root.toUpperCase()) == -1){
						indx = 0;
					}
					window.location.href = document.location.origin + new_root + '/' + path.split('/').slice(indx).join('/');

					$(".loader").hide();

					});
			});

		</script>


		{% block scripts %}
		{% endblock scripts %}

	</body>
</html>
