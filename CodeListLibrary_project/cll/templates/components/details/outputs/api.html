{% load compress %}
{% load entity_renderer %}

<!--   API   -->
<div class="col-sm-12 no-print shadow-frame">
	{% comment %} 
  <h3 class="paneltitle" id="API_Header" style="margin-top:20px; margin-bottom:20px;">
    <span id="API"></span>
    <strong>API</strong>
	</h3>
  {% endcomment %}

  {% get_brand_map_rules as brand_mapping %}
  {% get_template_entity_name entity_class=entity_class template=template as entity_tmpl_name %}
	<span id="api_id" entity_id="{{ entity.id }}">
		<p> To Export {{ entity_tmpl_name }} Details: </p>

		<table class="table table-striped table-responsive-md table-flex-rows">
		  <tr>
        <th>Format</th>
        <th>API</th>
		  </tr>

		  <tr>
        <td>JSON</td>
        <td>
          {% if user.is_authenticated %}
            <a href="{% url 'api:get_generic_entity_detail_by_version' entity.id entity.history_id %}?format=json"
              target=_blank>
                site_root{% url 'api:get_generic_entity_detail_by_version' entity.id entity.history_id %}?format=json
            </a>
          {% else %}
            <a href="{% url 'api:get_generic_entity_detail_by_version' entity.id entity.history_id %}?format=json"
                target=_blank>
                  site_root{% url 'api:get_generic_entity_detail_by_version' entity.id entity.history_id %}?format=json
            </a>
          {% endif %}
        </td>
      </tr>

      <tr>
        <td>R Package</td>
        <td>
          <code class="api-codeblock">
            <p class="code-comment-highlight">
              # <a href="https://github.com/SwanseaUniversityMedical/ConceptLibraryClient">Download here</a>
            </p>
            <p class="code-general-highlight">
              library(ConceptLibraryClient)
            </p>
            <br>
            <p class="code-comment-highlight">
              # Connect to API
            </p>
            <p class="code-general-highlight">
              client = ConceptLibraryClient::Connection$new(public=<span class="code-value-highlight">{% if user.is_authenticated %}FALSE{% else %}TRUE{% endif %}</span>)
            </p>
            <br>
            <p class="code-comment-highlight">
              # Get details of {{ brand_mapping.phenotype }}
            </p>
            <p class="code-general-highlight">
              {{ brand_mapping.phenotype|lower }}_details = client$phenotypes$get_detail(<br/>
                &nbsp;<span class="code-text-highlight">'{{ entity.id }}'</span>,<br/>
                &nbsp;version_id=<span class="code-value-highlight">{{ entity.history_id }}</span><br/>
              )
            </p>
          </code>
        </td>
      </tr>
      
      <tr>
        <td>Py Package</td>
        <td>
          <code class="api-codeblock">
            <p class="code-comment-highlight">
              # <a href="https://github.com/SwanseaUniversityMedical/pyconceptlibraryclient">Download here</a>
            </p>
            <p class="code-general-highlight">
              from pyconceptlibraryclient import Client
            </p>
            <br>
            <p class="code-comment-highlight">
              # Connect to API
            </p>
            <p class="code-general-highlight">
              client = Client(public=<span class="code-value-highlight">{% if user.is_authenticated %}False{% else %}True{% endif %}</span>)
            </p>
            <br>
            <p class="code-comment-highlight">
              # Get details of {{ brand_mapping.phenotype }}
            </p>
            <p class="code-general-highlight">
              {{ brand_mapping.phenotype|lower }}_detail = client.phenotypes.get_detail(<br/>
                &nbsp;<span class="code-text-highlight">'{{ entity.id }}'</span>,<br/>
                &nbsp;version_id=<span class="code-value-highlight">{{ entity.history_id }}</span><br/>
              )
            </p>
          </code>
        </td>
      </tr>
		</table>
		
		<p> To Export {{ entity_tmpl_name }} Code List:</p>
		<table class="table table-striped table-responsive-md table-flex-rows">
		  <tr>
        <th>Format</th>
        <th>API</th>
		  </tr>

		  <tr>
        <td>JSON</td>
        <td>
          <a href="{% url 'api:get_generic_entity_field_by_version' entity.id entity.history_id 'codes' %}?format=json"
            target=_blank>
              site_root{% url 'api:get_generic_entity_field_by_version' entity.id entity.history_id 'codes' %}?format=json
          </a>
        </td>
		  </tr>

		  {% if user_can_export %}
			<tr>
			  <td>CSV</td>
			  <td>
				  <a href="{% url 'export_entity_version_codes_to_csv' pk=entity.id history_id=entity.history_id %}"
				     target=_blank>
              site_root{% url 'export_entity_version_codes_to_csv' entity.id entity.history_id %}
          </a>
			  </td>
			</tr>
	    {% endif %}

      <tr>
        <td>R Package</td>
        <td>
          <code class="api-codeblock">
            <p class="code-comment-highlight">
              # <a href="https://github.com/SwanseaUniversityMedical/ConceptLibraryClient">Download here</a>
            </p>
            <p class="code-general-highlight">
              library(ConceptLibraryClient)
            </p>
            <br>
            <p class="code-comment-highlight">
              # Connect to API
            </p>
            <p class="code-general-highlight">
              client = ConceptLibraryClient::Connection$new(public=<span class="code-value-highlight">{% if user.is_authenticated %}FALSE{% else %}TRUE{% endif %}</span>)
            </p>
            <br>
            <p class="code-comment-highlight">
              # Get codelist of {{ brand_mapping.phenotype }}
            </p>
            <p class="code-general-highlight">
              {{ brand_mapping.phenotype|lower }}_codelist = client$phenotypes$get_codelist(<br/>
                &nbsp;<span class="code-text-highlight">'{{ entity.id }}'</span>,<br/>
                &nbsp;version_id=<span class="code-value-highlight">{{ entity.history_id }}</span><br/>
              )
            </p>
          </code>
        </td>
      </tr>

      <tr>
        <td>Py Package</td>
        <td>
          <code class="api-codeblock">
            <p class="code-comment-highlight">
              # <a href="https://github.com/SwanseaUniversityMedical/pyconceptlibraryclient">Download here</a>
            </p>
            <p class="code-general-highlight">
              from pyconceptlibraryclient import Client
            </p>
            <br>
            <p class="code-comment-highlight">
              # Connect to API
            </p>
            <p class="code-general-highlight">
              client = Client(public=<span class="code-value-highlight">{% if user.is_authenticated %}False{% else %}True{% endif %}</span>)
            </p>
            <br>
            <p class="code-comment-highlight">
              # Get codelist of {{ brand_mapping.phenotype }}
            </p>
            <p class="code-general-highlight">
              {{ brand_mapping.phenotype|lower }}_codelist = client.phenotypes.get_codelist(<br/>
                &nbsp;<span class="code-text-highlight">'{{ entity.id }}'</span>,<br/>
                &nbsp;version_id=<span class="code-value-highlight">{{ entity.history_id }}</span><br/>
              )
            </p>
          </code>
        </td>
      </tr>
		</table>
	</span>
</div>

<script type="text/javascript">
  domReady.finally(() => {
    let elem = document.querySelector('#api_id');
    let html = elem.innerHTML;
    html = html.replace(/site_root/g, 'http://' + document.location.host);
    elem.innerHTML = html;
  });
</script>
