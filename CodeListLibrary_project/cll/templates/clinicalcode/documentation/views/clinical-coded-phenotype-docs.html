{% load static %}
{% load entity_renderer %}

{% get_brand_map_rules as brand_mapping %}
<div class="page-split__left">
  <aside class="scrollspy">
    <div class="scrollspy__container">
      <button class="scrollspy__container__item scrollspy__container__item--tertiary active"
        aria-label="What are {{ brand_mapping.phenotype }}s?" data-target="#what-are-{{ brand_mapping.phenotype }}s">
        <a href="#what-are-{{ brand_mapping.phenotype }}s">What are {{ brand_mapping.phenotype }}s?</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="{{ brand_mapping.phenotype }}s" data-target="#{{ brand_mapping.phenotype }}s">
        <a href="#{{ brand_mapping.phenotype }}s">{{ brand_mapping.phenotype }}s</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="Accessing the creation pages" data-target="#accessing-create">
        <a href="#accessing-create">Accessing the creation pages</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="Selecting your template" data-target="#selecting-templates">
        <a href="#selecting-templates">Selecting your template</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="The creation wizard" data-target="#creation-wizard">
        <a href="#creation-wizard">The creation wizard</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="Adding {{ brand_mapping.concept }}s" data-target="#adding-{{ brand_mapping.concept }}s">
        <a href="#adding-{{ brand_mapping.concept }}s">Adding {{ brand_mapping.concept }}s</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="Creating a {{ brand_mapping.concept }}" data-target="#creating-{{ brand_mapping.concept }}s">
        <a href="#creating-{{ brand_mapping.concept }}s">Creating a {{ brand_mapping.concept }}</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="Finalising your {{ brand_mapping.concept }}" data-target="#finalising-{{ brand_mapping.concept }}s">
        <a href="#finalising-{{ brand_mapping.concept }}s">Finalising your {{ brand_mapping.concept }}</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="Searchterm rules" data-target="#searchterm-rules">
        <a href="#searchterm-rules">Searchterm rules</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="File import rules" data-target="#file-imports">
        <a href="#file-imports">File import rules</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="Using {{ brand_mapping.concept }}s as rules" data-target="#{{ brand_mapping.concept }}-as-rules">
        <a href="#{{ brand_mapping.concept }}-as-rules">Using {{ brand_mapping.concept }}s as rules</a>
      </button>
      <button class="scrollspy__container__item scrollspy__container__item--tertiary"
        aria-label="Importing {{ brand_mapping.concept }}s" data-target="#importing-{{ brand_mapping.concept }}s">
        <a href="#importing-{{ brand_mapping.concept }}s">Importing {{ brand_mapping.concept }}s</a>
      </button>
    </div>
  </aside>
</div>
<div class="page-split__right">
  <div class="page-split__container">
    <h2>
      Learn about {{ brand_mapping.phenotype }}s
    </h2>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="what-are-{{ brand_mapping.phenotype }}s"></span>
        What are {{ brand_mapping.phenotype }}s?
      </h3>
      <p>
        A {{ brand_mapping.phenotype }} is an observable and measurable piece of information that is relevant to health or healthcare.
        For example, it can be a disease (e.g. type 2 diabetes), a blood pressure measurement, a blood sugar value 
        or a prescription of antibiotics.
      </p>
      <p>
        Phenotyping algorithms are special tools that enable researchers to extract {{ brand_mapping.phenotype }}s from complex, and 
        often messy data that get generated during routine interactions within the healthcare system. 
        They identify and extract data from medical records using clinical codes which are the building block of 
        how information is recorded in healthcare (for example ICD-10). Using these specialised algorithms, 
        researchers and clinicians can maximise the value of patient data contained in medical records and 
        answer important questions that can improve health and healthcare. 
      </p>
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="{{ brand_mapping.phenotype }}s"></span>
        {{ brand_mapping.phenotype }}s
      </h3>
      <p>
        {{ brand_mapping.phenotype }} are definitions that are applied to structured health data and 
        involve the use of clinical codelists. A {{ brand_mapping.phenotype }} may have one or more components associated with them, 
        referred to as a “<em>{{ brand_mapping.concept }}</em>”. 
      </p>
      <h4>
        {{ brand_mapping.concept }}s
      </h4>
      <p>
        Each {{ brand_mapping.concept }} defines a single codelist using a single clinical coding system, and having a particular meaning. 
      </p>
      <p>
        Different {{ brand_mapping.concept }}s may define the {{ brand_mapping.phenotype }} in different contexts: for example, an asthma {{ brand_mapping.phenotype }} may have a 
        {{ brand_mapping.concept }} defining asthma in secondary care using ICD-10, and another {{ brand_mapping.concept }} defining asthma in primary care 
        using SNOMED-CT.
      </p>
      <p>
        {{ brand_mapping.concept }} may also define different attributes or events associated with a {{ brand_mapping.phenotype }}. For example, a depression 
        {{ brand_mapping.phenotype }} may have a {{ brand_mapping.concept }} defining depression symptoms, another defining a diagnosis of depression, and a 
        third defining antidepressant medication.
      </p>
      <h4>
        Defining {{ brand_mapping.concept }}s with Rules
      </h4>
      <p>
        The codes within a {{ brand_mapping.concept }} are defined using one or more rules. The rules are as follows:
      </p>
      <ul>
        <li>
          <p>
            <strong>Search:</strong> use a search term or regular expression to identify codes. 
            This can be based on the code itself (for example, all ICD10 codes that start with “<em>A1</em>”), 
            or the description (such as all Read codes that mention “<em>diabetes</em>”). 
            If the regular expression option is selected, Perl compatible regular expressions can be used to 
            define more complex criteria.  
          </p>
        </li>
        <li>
          <p>
            <strong>File Import:</strong> upload an existing list of codes that has been created elsewhere.
            <br/>
            <br/>
            <em><strong>Please note:</strong></em>
            <ul>
              <li>
                It is expected that your file contains only a single codelist containing a set of codes
                that are only associated with a single type of clinical terminology, <em>e.g.</em> an ICD-10 codelist.
              </li>
              <li>
                It is also expected that the file is composed of <strong>at least two columns</strong>: <em><strong>(1)</strong>the first containing the code</em>;
                and <em><strong>(1)</strong>the second containing the terms or description associated with that code</em>.
                <br/>
                In the case of an ICD-10 codelist, a row might look like this: “<em>A00.0,Cholera due to Vibrio cholerae 01, biovar cholerae</em>”
                <br/>
                <strong>Note:</strong> In this example, the first column denotes the code and the second contains the description - the remaining columns, if any, would be ignored.  
              </li>
            </ul>
          </p>
        </li>
        <li>
          <p>
            <strong>Import from another {{ brand_mapping.phenotype }}:</strong> {{ brand_mapping.concept }}s that exist in other {{ brand_mapping.phenotype }} in 
            the library can be referred to and used as building blocks to create a new {{ brand_mapping.phenotype }}. 
            For example, a new {{ brand_mapping.phenotype }} “<em>Heart Conditions</em>” could be created by combining existing 
            definitions of heart attack, heart failure, high blood pressure, and other diseases.
          </p>
        </li>
      </ul>
      <p>
        Multiple inclusion rules can be used to add codes and build up the codelist; additionally, 
        exclusion rules can be used to remove codes that would otherwise be included. 
      </p>
      <h4>
        Exceptions to how Rules function
      </h4>
      <p>
        There are some exceptions to the functionality of rules:
      </p>
      <ul>
        <li>
          <p>
            <strong>Excluding codes from a file upload:</strong> it is not possible to exclude codes imported with a file rule.
            If you encounter this, we recommend you remove that code from your codelist file.
          </p>
        </li>
        <li>
          <p>
            <strong>Custom coding systems:</strong> it is not possible to exclude custom codes - 
            the codes must match an existing, known codelist that is available from our clinical terminology repository.
          </p>
        </li>
        <li>
          <p>
            <strong>Exclusionary types:</strong> it is not possible to exclude codes through a file upload - 
            codes can only be excluded via search rules or imported codelists.
          </p>
        </li>
      </ul>
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="accessing-create"></span>
        Accessing the creation pages
      </h3>
      <p>
        Users can access the creation page via the search page - this can be accessed by selecting 
        the “{{ brand_mapping.phenotype }}s“ button (marked in red) seen in the navigation bar.
        To begin working on a {{ brand_mapping.phenotype }} users must click the link within the “Create a {{ brand_mapping.phenotype }}“ 
        card (seen below in pink).
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image1.png' %}"
        alt="Accessing the Create page" />
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="selecting-templates"></span>
        Selecting your template
      </h3>
      <p>
        To start creating a {{ brand_mapping.phenotype }} the users must select the template they wish to follow. 
        Different templates may be created for different types of algorithms, data settings, etc.
      </p>
      <ul>
        <li>
          <p>
            <strong>Clinical Coded {{ brand_mapping.phenotype }}:</strong> {{ brand_mapping.phenotype }}s that apply to structured 
            health data and involve the use of clinical codes.
          </p>
        </li>
      </ul>
      <p>
        This tutorial relates to the process for Clinical Coded {{ brand_mapping.phenotype }}s, though other 
        templates will be similar. Click the appropriate template button as shown below:
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image2.png' %}"
        alt="Selecting a Template" />
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="creation-wizard"></span>
        The creation wizard
      </h3>
      <p>
        After the user selects their template they will be referred to the wizard page. 
        This page describes what details the template can store, and which fields are 
        required to continue. Any field that is mandatory will be marked with a red 
        asterisk as highlighted below:
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image3.png' %}"
        alt="Required fields in the Creation Wizard" />
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="adding-{{ brand_mapping.concept }}s"></span>
        Adding {{ brand_mapping.concept }}s
      </h3>
      <p>
        The “<em>Clinical codelist</em>” section allows researchers to define the {{ brand_mapping.concept }}s 
        and associated codes that will be used to define their {{ brand_mapping.phenotype }}. To start, 
        the user can either (a) create a new {{ brand_mapping.concept }} (red) or (b) import an existing 
        {{ brand_mapping.concept }} from another {{ brand_mapping.phenotype }} (pink).
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image4.png' %}"
        alt="Adding {{ brand_mapping.concept }}s to your {{ brand_mapping.phenotype }}" />
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="creating-{{ brand_mapping.concept }}s"></span>
        Creating a {{ brand_mapping.concept }}
      </h3>
      <p>
        If the user decides to create a new {{ brand_mapping.concept }} they will be met with the 
        option to define the coding system that will be used to create the 
        {{ brand_mapping.concept }}, and to define some basic metadata such as the {{ brand_mapping.concept }}&#8217;s name.
      </p>
      <p>
        As seen in the image below, a coding system must be selected first 
        before the system will allow it to add any associated rules or codes:
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image5.png' %}"
        alt="Adding a Coding System" />
      <p>
        To add a new rule, the user can select the “<em>Add Rule</em>” button 
        in either the “<em>Inclusion Rules</em>” or “<em>Exclusion Rules</em>” section:
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image6.png' %}"
        alt="Adding a new Rule" />
      <p>
        After adding or modifying a rule the user will be notified 
        of the changes made to the codelist by a toast notification on 
        the bottom right of the screen (seen below in pink). 
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image7.png' %}"
        alt="Adding a codes with your Rule" />
      <p>
        The codelist, as generated by the user&#8217;s rules, will be visible 
        in the “<em>codelist</em>” section. The table columns can be sorted by 
        clicking on the header of each column.
      </p>
      <p>
        Some important notes regarding the columns:
      </p>
      <ul>
        <li>
          <p>
            The “<em>Final</em>” column (red box) describes whether the code will 
            be included or excluded from the final codelist
          </p>
        </li>
        <li>
          <p>
            The columns with names that match the given rules (pink box) 
            describe whether that code was included or excluded by that 
            rule, and will be blank if the code was not present in that rule
          </p>
        </li>
      </ul>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image8.png' %}"
        alt="Inclusionary and Exclusionary Rules" />
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="finalising-{{ brand_mapping.concept }}s"></span>
        Finalising your {{ brand_mapping.concept }}
      </h3>
      <p>
        After finalising the {{ brand_mapping.concept }}&#8217;s associated rules and codes, the user can 
        click the “<em>Confirm</em>” button to save those changes locally. 
        They will be prompted to do so if they try to submit the {{ brand_mapping.phenotype }} 
        before doing so. 
      </p>
      <p>
        If they decide to cancel these changes by clicking the “<em>Cancel</em>” button 
        then the {{ brand_mapping.concept }} will be reverted to its previous state, if any.
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image9.png' %}"
        alt="Finalising your {{ brand_mapping.concept }}" />
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="searchterm-rules"></span>
        Searchterm rules
      </h3>
      <p>
        Selecting the “<em>Add Searchterm</em>” option will add a search rule - these 
        attempt to add codes by matching a string to one or more codes through 
        its code&#8217;s identifier or its description.
      </p>
      <p>
        There are search options present beneath the search input which can be 
        used to vary the results of a given term, or to capture using patterns. 
        We accept <a href="https://regexone.com/">Regex</a> for pattern-based search.
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image10.png' %}"
        alt="Using Searchterm rules" />
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="file-imports"></span>
        File import rules
      </h3>
      <p>
        These can be used to fulfil the need to upload codelists that have 
        been created in the past, or can be used to support workflows where 
        users are modifying or iterating on codelists that have been used 
        in research papers.
      </p>
      <p>
        Currently, only .CSV, .XLSX and OpenDocument files are supported.
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image11.png' %}"
        alt="Adding a file import Rule" />
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="{{ brand_mapping.concept }}-as-rules"></span>
        Using {{ brand_mapping.concept }}s as rules
      </h3>
      <p>
        {{ brand_mapping.concept }}s from other {{ brand_mapping.phenotype }}s can be used as rules to build up or 
        modify a codelist. This allows combining different specific 
        {{ brand_mapping.concept }}s to create a more general one, etc. 
      </p>
      <p>
        When a {{ brand_mapping.concept }} is added as a rule, only the final codelist of 
        that {{ brand_mapping.concept }} is imported, and those codes are used as an 
        inclusion or exclusion criterion in a similar manner to other rules.
      </p>
      <p>
        If you want to add an entire existing {{ brand_mapping.concept }} to a {{ brand_mapping.phenotype }} 
        and present it in its original form, do not add it as a rule, 
        but use “<em>Import {{ brand_mapping.concept }}s</em>” instead (see below).  
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image12.png' %}"
        alt="Using a {{ brand_mapping.concept }} as a Rule" />
    </section>
    <section class="about-container__section__text">
      <h3 class="subheader">
        <span class="scrollspy-target" id="importing-{{ brand_mapping.concept }}s"></span>
        Importing {{ brand_mapping.concept }}s
      </h3>
      <p>
        Importing a {{ brand_mapping.concept }} from another {{ brand_mapping.phenotype }} adds it to the new 
        {{ brand_mapping.phenotype }} as a top-level entity, with all its rules presented 
        as they were in the original {{ brand_mapping.phenotype }}. 
      </p>
      <p>
        By selecting the “<em>Import {{ brand_mapping.concept }}s</em>” button, the user will 
        be prompted by a modal to select the {{ brand_mapping.concept }}s they would 
        like to import. 
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image13.png' %}"
        alt="Importing one or more {{ brand_mapping.concept }}s" />
      <p>
        The user can select one or more {{ brand_mapping.concept }}s to import by expanding 
        the “<em>Available {{ brand_mapping.concept }}s</em>” section and clicking each individual 
        {{ brand_mapping.concept }} they would like to import.
      </p>
      <p>
        After confirming their choices, they will be met with a screen 
        similar to this:
      </p>
      <img loading="lazy" class="about-container__alt-image"
        src="{% static 'img/documentation/clinical-coded-phenotypes/image14.png' %}"
        alt="Imported {{ brand_mapping.concept }}s in the viewer" />
    </section>
  </div>
</div>
