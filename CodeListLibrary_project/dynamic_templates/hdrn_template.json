{
  "fields": {
    "validations": {
      "title": "Validation",
      "active": true,
      "field_type": "textarea_markdown",
      "validation": {
        "type": "string",
        "sanitise": "markdown",
        "mandatory": false
      },
      "description": "A description of the methods used to validate this Concept (optional)."
    },
    "related_references": {
      "title": "Related Reference",
      "description": "A list of third party references related to this Concept",
      "field_type": "references",
      "active": true,
      "validation": {
        "type": "references",
        "mandatory": false
      }
    },
    "source_reference": {
      "title": "Source Reference",
      "active": true,
      "field_type": "string_inputbox",
      "validation": {
        "type": "string",
        "sanitise": "strict",
        "mandatory": false
      },
      "description": ""
    },
    "limitations": {
      "title": "Limitations & Cautions",
      "active": true,
      "field_type": "textarea_markdown",
      "validation": {
        "type": "string",
        "sanitise": "markdown",
        "mandatory": false
      },
      "description": "Limitations, constraints and/or cautions that should be considered when implementation this Concept."
    },
    "background": {
      "title": "Background",
      "active": true,
      "field_type": "textarea_markdown",
      "validation": {
        "type": "string",
        "sanitise": "markdown",
        "mandatory": false
      },
      "description": "A overview of the Concept."
    },
    "implementation": {
      "title": "Implementation",
      "active": true,
      "field_type": "textarea_markdown",
      "validation": {
        "type": "string",
        "sanitise": "markdown",
        "mandatory": false
      },
      "description": "Information on how the Phenotype is applied to data."
    },
    "hdrn_resource_ref": {
      "title": "HDRN Resource Reference",
      "active": true,
      "field_type": "string_inputbox",
      "validation": {
        "type": "string",
        "sanitise": "strict",
        "mandatory": false
      },
      "description": ""
    },
    "phenotype_uuid": {
      "title": "Phenotype UUID",
      "active": true,
      "search": {
        "api": true
      },
      "field_type": "string_inputbox_code",
      "validation": {
        "type": "string",
        "length": [
          0,
          250
        ],
        "unique": true,
        "sanitise": "strict",
        "mandatory": false
      },
      "description": "If applicable, the UUID referencing this Concept's HDRUK source (optional).",
      "hide_if_empty": true,
      "requires_auth": true,
      "hide_on_create": true
    },
    "ontology": {
      "title": "Ontology",
      "active": true,
      "search": {
        "api": true,
        "filterable": true
      },
      "hydrated": true,
      "field_type": "ontology",
      "validation": {
        "type": "int_array",
        "source": {
          "model": "OntologyTag",
          "trees": [
            0,
            1,
            2
          ],
          "subquery": {
            "id": {
              "type": "int_array",
              "field": "id",
              "modifiers": [
                "descendants"
              ]
            },
            "code": {
              "key": "code",
              "type": "string_array",
              "field": "properties",
              "modifiers": [
                "descendants"
              ],
              "field_type": "jsonb"
            },
            "name": {
              "type": "string_array",
              "field": "name",
              "modifiers": [
                "descendants"
              ]
            },
            "type": {
              "type": "int_array",
              "field": "type_id"
            },
            "reference": {
              "type": "int_array",
              "field": "reference_id",
              "modifiers": [
                "descendants"
              ]
            }
          },
          "references": {
            "trim": true,
            "mapping": {
              "icd9": {
                "type": "string",
                "match_in": "icd9_codes",
                "match_out": "code",
                "match_src": "clinicalcode_SNOMED_CODES",
                "match_type": "overlap",
                "link_target": "properties__code"
              },
              "mesh": {
                "type": "string",
                "match_in": "mesh_codes",
                "match_out": "code",
                "match_src": "clinicalcode_SNOMED_CODES",
                "match_type": "overlap",
                "link_target": "properties__code"
              },
              "icd10": {
                "type": "string",
                "match_in": "icd10_codes",
                "match_out": "code",
                "match_src": "clinicalcode_SNOMED_CODES",
                "match_type": "overlap",
                "link_target": "properties__code"
              },
              "opsc4": {
                "type": "string",
                "match_in": "opcs4_codes",
                "match_out": "code",
                "match_src": "clinicalcode_SNOMED_CODES",
                "match_type": "overlap",
                "link_target": "properties__code"
              },
              "readv2": {
                "type": "string",
                "match_in": "readcv2_codes",
                "match_out": "code",
                "match_src": "clinicalcode_SNOMED_CODES",
                "match_type": "overlap",
                "link_target": "properties__code"
              },
              "readv3": {
                "type": "string",
                "match_in": "readcv3_codes",
                "match_out": "code",
                "match_src": "clinicalcode_SNOMED_CODES",
                "match_type": "overlap",
                "link_target": "properties__code"
              },
              "snomed": {
                "type": "string",
                "match_in": "code",
                "match_out": "code",
                "match_src": "clinicalcode_SNOMED_CODES",
                "match_type": "in",
                "link_target": "properties__code"
              }
            },
            "pattern": "^(\\w+):([\\w\\.\\-\\_ ]+)$",
            "transform": "([^a-zA-Z0-9]+)"
          }
        },
        "mandatory": false
      },
      "description": "A set of taggable categories and concepts that best describe this Concept (optional)."
    },
    "sites": {
      "title": "Site(s)",
      "active": true,
      "search": {
        "api": true
      },
      "hydrated": true,
      "field_type": "data_sources",
      "validation": {
        "type": "int_array",
        "source": {
          "query": "id",
          "table": "HDRNSite",
          "include": [
            "description"
          ],
          "relative": "name"
        },
        "mandatory": false
      },
      "description": "Site(s) that developed this Concept"
    },
    "category": {
      "title": "Category",
      "active": true,
      "search": {
        "api": true
      },
      "hydrated": true,
      "field_type": "data_sources",
      "validation": {
        "type": "int_array",
        "source": {
          "query": "id",
          "table": "HDRNDataCategory",
          "include": [
            "description"
          ],
          "relative": "name"
        },
        "mandatory": false
      },
      "description": "A list identifying categories referenced by this Concept (optional)."
    },
    "related_concepts": {
      "title": "Related Concepts",
      "active": true,
      "search": {
        "api": true
      },
      "hydrated": true,
      "field_type": "data_sources",
      "validation": {
        "type": "string_array",
        "source": {
          "query": "id",
          "table": "GenericEntity",
          "include": [
            "name"
          ],
          "filter": {
            "status": 2
          },
          "relative": "id"
        },
        "mandatory": false
      },
      "description": "A list concepts related to this concept."
    },
    "data_assets": {
      "title": "Data Assets",
      "active": true,
      "search": {
        "api": true
      },
      "hydrated": true,
      "field_type": "data_sources",
      "validation": {
        "type": "int_array",
        "source": {
          "query": "id",
          "table": "HDRNDataAsset",
          "include": [
            "link",
            "hdrn_uuid"
          ],
          "relative": "name"
        },
        "mandatory": false
      },
      "description": "A list identifying data assets referenced, used or required by this Concept (optional)."
    },
    "event_date_range": {
      "title": "Valid Event Date Range",
      "active": true,
      "field_type": "daterange",
      "validation": {
        "type": "string",
        "regex": [
          "(?:\\d+\\/|\\d+)+[\\s+]?-[\\s+]?(?:\\d+\\/|\\d+)+",
          "[\\s+]?\\-[\\s+]?(?:\\d+\\/|\\d+)+",
          "(?:\\d+\\/|\\d+)+[\\s+]?\\-[\\s+]?"
        ],
        "mandatory": false,
        "date_closure_optional": false
      },
      "description": "If this Concept is only applicable within a limited time period, please specify that here. End date is optional (optional)."
    },
    "sex": {
      "title": "Sex",
      "active": true,
      "search": {
        "api": true
      },
      "field_type": "grouped_enum",
      "validation": {
        "type": "enum",
        "options": {
          "1": "Male",
          "2": "Female",
          "3": "Both",
          "4": "Neither"
        },
        "mandatory": true,
        "properties": [
          {
            "when": [
              "1",
              "2"
            ],
            "result": "3"
          }
        ]
      },
      "description": "The biological sex this Concept is applicable to."
    },
    "age": {
      "title": "Age",
      "active": true,
      "search": {
        "api": true
      },
      "field_type": "enum_dropdown_badge",
      "validation": {
        "type": "enum",
        "options": {
          "1": "< 18 yrs",
          "2": "18-35 yrs",
          "3": "35-60 yrs",
          "4": ">60 yrs"
        },
        "mandatory": true,
        "properties": []
      },
      "description": "The age range this Concept is applicable to."
    },
    "agreement_date": {
      "title": "Agreement Date",
      "active": false,
      "field_type": "date",
      "validation": {
        "type": "string",
        "regex": "(0[1-9]|[12]\\d|30|31)\\/(0[1-9]|1[0-2])\\/(\\d{4})",
        "mandatory": false
      },
      "description": "A date representing when this Concept was first finalised (may predate the Concept Library). Deprecated.",
      "hide_if_empty": true,
      "hide_on_create": true
    },
    "coding_system": {
      "title": "Coding System",
      "active": true,
      "search": {
        "api": true,
        "filterable": true
      },
      "field_type": "coding_system",
      "validation": {
        "type": "int_array",
        "source": {
          "query": "codingsystem_id",
          "table": "CodingSystem",
          "relative": "name"
        },
        "computed": true,
        "mandatory": false
      },
      "description": "Clinical coding system(s) contained by this Concept. A Concept may have multiple concepts, each with its own coding system. All contained coding systems are programmatically represented here.",
      "hide_on_create": true
    },
    "phenoflowid": {
      "title": "Phenoflow ID",
      "active": true,
      "field_type": "phenoflowid",
      "validation": {
        "type": "string",
        "regex": "^https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b(?:[-a-zA-Z0-9()@:%_\\+.~#?&\\/=]*)$",
        "length": [
          0,
          500
        ],
        "mandatory": false
      },
      "description": "URL of this Concept's PhenoFLOW implementation, if applicable (optional). For more information: https://kclhi.org/phenoflow/",
      "hide_if_empty": true
    },
    "concept_information": {
      "title": "Clinical Codes",
      "active": true,
      "field_type": "concept_information",
      "validation": {
        "type": "concept",
        "mandatory": false,
        "has_children": true
      },
      "description": "A set of concepts, each of which defines a list of clinical codes, contained within this Concept."
    }
  },
  "sections": [
    {
      "title": "Name & Author",
      "fields": [
        "name",
        "author",
        "sites"
      ],
      "description": "",
      "hide_on_detail": true
    },
    {
      "title": "Overview",
      "fields": [
        "hdrn_resource_ref",
        "type",
        "phenotype_uuid",
        "sex",
        "age",
        "event_date_range",
        "coding_system",
        "data_assets",
        "category",
        "collections",
        "tags",
        "ontology"
      ],
      "description": "A set of descriptors that defines this Concept."
    },
    {
      "title": "Definition",
      "fields": [
        "definition",
        "implementation",
        "validations",
        "limitations"
      ],
      "description": "Information describing this Concept and documentation concerning it methodology, validation & usage"
    },
    {
      "title": "Components",
      "fields": [
        "concept_information"
      ],
      "description": "Clinical codes that defines this Concept.",
      "documentation": "clinical-coded-phenotype-docs"
    },
    {
      "title": "Publication",
      "fields": [
        "publications",
        "citation_requirements"
      ],
      "description": "Publications that reference this Concept and how this Concept might be cited in further research."
    },
    {
      "title": "References & Relationships",
      "fields": [
        "related_concepts",
        "source_reference",
        "related_references"
      ],
      "description": "A set of related Concepts, sources, and resources."
    }
  ],
  "template_details": {
    "name": "HDRN Concept",
    "version": 1,
    "card_type": "clinical",
    "description": "Concept definitions that are based on lists of clinical codes, or algorithms using clinical codes."
  }
}